<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="9" failures="2" skipped="0" tests="19" time="0.344" timestamp="2026-02-22T04:11:28.165397+00:00" hostname="agent-env-8406b534-fe63-4da2-af4b-da05be5d8db0"><testcase classname="tests.test_slack_webchat_parity.TestHealthEndpoint" name="test_health_endpoint_returns_healthy" time="0.020"><failure message="requests.exceptions.MissingSchema: Invalid URL '/api/health': No scheme supplied. Perhaps you meant https:///api/health?">tests/test_slack_webchat_parity.py:51: in test_health_endpoint_returns_healthy
    response = requests.get(f"{BASE_URL}/api/health", timeout=10)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:73: in get
    return request("get", url, params=params, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
/root/.venv/lib/python3.11/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
/root/.venv/lib/python3.11/site-packages/requests/models.py:438: in prepare_url
    raise MissingSchema(
E   requests.exceptions.MissingSchema: Invalid URL '/api/health': No scheme supplied. Perhaps you meant https:///api/health?</failure></testcase><testcase classname="tests.test_slack_webchat_parity.TestOrchestratorToolsConfig" name="test_gateway_config_does_not_have_web_search" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_gateway_config_does_not_have_web_search' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_gateway_config_does_not_have_web_search' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestOrchestratorToolsConfig" name="test_gateway_config_has_delegate_tool" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_delegate_tool' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_delegate_tool' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestOrchestratorToolsConfig" name="test_gateway_config_has_list_agents_tool" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_list_agents_tool' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_list_agents_tool' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestOrchestratorToolsConfig" name="test_gateway_config_has_prompt_version_3" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_prompt_version_3' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_gateway_config_has_prompt_version_3' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestOrchestratorToolsConfig" name="test_orchestrator_prompt_starts_with_overclaw" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_orchestrator_prompt_starts_with_overclaw' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_orchestrator_prompt_starts_with_overclaw' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestResearchSpecialistConfig" name="test_research_specialist_has_web_search" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_research_specialist_has_web_search' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_research_specialist_has_web_search' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestResearchSpecialistConfig" name="test_research_specialist_has_browse_webpage" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_research_specialist_has_browse_webpage' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_research_specialist_has_browse_webpage' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestServerCodeValidation" name="test_orchestrator_tools_list_no_web_search" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestServerCodeValidation" name="test_server_uses_set_comparison_for_tools_patching" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestServerCodeValidation" name="test_server_has_versioned_prompt_mechanism" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestAgentDiagnosticLogging" name="test_agent_has_diagnostic_logging" time="0.001"><failure message="AssertionError: Diagnostic log should include session, agent, delegate, web_search info&#10;assert None&#10; +  where None = &lt;function search at 0xfb1545deccc0&gt;('logger\\.info\\([^)]*session.*agent.*delegate.*web_search', '&quot;&quot;&quot;\nAgent Runtime — Phase 2\nLLM provider abstraction with native tool/function calling.\nUses OpenAI and Anthropic SDKs directly for tool-calling support.\nInspired by OpenClaw\'s pi-embedded-runner.\n&quot;&quot;&quot;\nimport os\nimport json\nimport asyncio\nimport logging\nfrom datetime import datetime, timezone\nfrom typing import Optional\n\nfrom openai import AsyncOpenAI\nfrom anthropic import AsyncAnthropic\n\nfrom gateway.config_schema import AssistantConfig\nfrom gateway.tools import get_tool, get_tools_for_openai, get_tools_for_anthropic\n\nlogger = logging.getLogger(&quot;gateway.agent&quot;)\n\nMAX_TOOL_ITERATIONS = 25  # Browser interactions can chain many steps\n\n\nasync def _safe_extract_memories(db, session_id, agent_id, user_text, response_text):\n    &quot;&quot;&quot;Fire-and-forget wrapper for memory extraction.&quot;&quot;&quot;\n    try:\n        from gateway.memory import extract_and_store_memories\n        await extract_and_store_memories(db, session_id, agent_id, user_text, response_text)\n    except Exception as e:\n        logger.warning(f&quot;Memory extraction failed: {e}&quot;)\n\n\nasync def _safe_extract_profile(db, user_text):\n    &quot;&quot;&quot;Fire-and-forget wrapper for user profile extraction.&quot;&quot;&quot;\n    try:\n      ...         allowed_set = set(tools_allowed)\n            return [t for t in tools_list if t.get(&quot;name&quot;, t.get(&quot;function&quot;, {}).get(&quot;name&quot;, &quot;&quot;)) in allowed_set]\n\n        logger.info(f&quot;Subtask: agent={agent_id} model={provider}/{model_id} task={task[:80]}...&quot;)\n\n        try:\n            if provider == &quot;openai&quot;:\n                tools = filter_tools(get_tools_for_openai())\n                response_text, tool_calls = await run_openai_turn(\n                    api_key, model_id, system_prompt, llm_messages, tools,\n                )\n            elif provider == &quot;anthropic&quot;:\n                tools = filter_tools(get_tools_for_anthropic())\n                response_text, tool_calls = await run_anthropic_turn(\n                    api_key, model_id, system_prompt, llm_messages, tools,\n                )\n            else:\n                return f&quot;Error: unsupported provider \'{provider}\'&quot;\n\n            logger.info(f&quot;Subtask complete: agent={agent_id} tools={len(tool_calls)} response_len={len(response_text)}&quot;)\n            return response_text\n\n        except Exception as e:\n            logger.exception(f&quot;Subtask error: agent={agent_id}&quot;)\n            return f&quot;Error: {str(e)}&quot;\n')&#10; +    where &lt;function search at 0xfb1545deccc0&gt; = re.search">tests/test_slack_webchat_parity.py:286: in test_agent_has_diagnostic_logging
    assert re.search(log_pattern, content), \
E   AssertionError: Diagnostic log should include session, agent, delegate, web_search info
E   assert None
E    +  where None = &lt;function search at 0xfb1545deccc0&gt;('logger\\.info\\([^)]*session.*agent.*delegate.*web_search', '"""\nAgent Runtime — Phase 2\nLLM provider abstraction with native tool/function calling.\nUses OpenAI and Anthropic SDKs directly for tool-calling support.\nInspired by OpenClaw\'s pi-embedded-runner.\n"""\nimport os\nimport json\nimport asyncio\nimport logging\nfrom datetime import datetime, timezone\nfrom typing import Optional\n\nfrom openai import AsyncOpenAI\nfrom anthropic import AsyncAnthropic\n\nfrom gateway.config_schema import AssistantConfig\nfrom gateway.tools import get_tool, get_tools_for_openai, get_tools_for_anthropic\n\nlogger = logging.getLogger("gateway.agent")\n\nMAX_TOOL_ITERATIONS = 25  # Browser interactions can chain many steps\n\n\nasync def _safe_extract_memories(db, session_id, agent_id, user_text, response_text):\n    """Fire-and-forget wrapper for memory extraction."""\n    try:\n        from gateway.memory import extract_and_store_memories\n        await extract_and_store_memories(db, session_id, agent_id, user_text, response_text)\n    except Exception as e:\n        logger.warning(f"Memory extraction failed: {e}")\n\n\nasync def _safe_extract_profile(db, user_text):\n    """Fire-and-forget wrapper for user profile extraction."""\n    try:\n      ...         allowed_set = set(tools_allowed)\n            return [t for t in tools_list if t.get("name", t.get("function", {}).get("name", "")) in allowed_set]\n\n        logger.info(f"Subtask: agent={agent_id} model={provider}/{model_id} task={task[:80]}...")\n\n        try:\n            if provider == "openai":\n                tools = filter_tools(get_tools_for_openai())\n                response_text, tool_calls = await run_openai_turn(\n                    api_key, model_id, system_prompt, llm_messages, tools,\n                )\n            elif provider == "anthropic":\n                tools = filter_tools(get_tools_for_anthropic())\n                response_text, tool_calls = await run_anthropic_turn(\n                    api_key, model_id, system_prompt, llm_messages, tools,\n                )\n            else:\n                return f"Error: unsupported provider \'{provider}\'"\n\n            logger.info(f"Subtask complete: agent={agent_id} tools={len(tool_calls)} response_len={len(response_text)}")\n            return response_text\n\n        except Exception as e:\n            logger.exception(f"Subtask error: agent={agent_id}")\n            return f"Error: {str(e)}"\n')
E    +    where &lt;function search at 0xfb1545deccc0&gt; = re.search</failure></testcase><testcase classname="tests.test_slack_webchat_parity.TestSlackDebugCommand" name="test_slack_channel_has_debug_command" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestSlackDebugCommand" name="test_slack_debug_command_shows_agent_config" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestSlackDebugCommand" name="test_slack_help_command_mentions_debug" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestAgentsConfigValidation" name="test_orchestrator_prompt_starts_correctly" time="0.001" /><testcase classname="tests.test_slack_webchat_parity.TestAgentsConfigValidation" name="test_specialist_agents_includes_research" time="0.000" /><testcase classname="tests.test_slack_webchat_parity.TestE2EConfigConsistency" name="test_orchestrator_tools_consistency" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_orchestrator_tools_consistency' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_orchestrator_tools_consistency' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase><testcase classname="tests.test_slack_webchat_parity.TestE2EConfigConsistency" name="test_no_web_search_anywhere_in_orchestrator_path" time="0.000"><error message="failed on setup with &quot;pytest.PytestRemovedIn9Warning: 'test_no_web_search_anywhere_in_orchestrator_path' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.&#10;See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture&quot;">/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:458: in setup
    return super().setup()
           ^^^^^^^^^^^^^^^
/root/.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_no_web_search_anywhere_in_orchestrator_path' requested an async fixture 'db', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture</error></testcase></testsuite></testsuites>